<form
  class="checkout_form"
  [formGroup]="checkoutForm"
  (ngSubmit)="submitCheckoutForm()"
>
  <button type="button" class="btn">Go back</button>
  <div class="content">
    <div class="checkout_div card">
      <h3>Checkout</h3>
      <div class="details billing_details" formGroupName="billingDetails">
        <p>Billing Details</p>
        <div class="inputs_wrapper">
          <div class="input_container">
            <label for="name">Name</label>
            <app-auth-input
              id="name"
              type="text"
              placeholder="Alexei Ward"
              [formControlName]="'name'"
              [hasError]="!!(checkoutForm.get('billingDetails.name')?.invalid && (checkoutForm.get('billingDetails.name')?.touched || checkoutForm.get('billingDetails.name')?.dirty))"
              [errorMessage]="checkoutForm.get('billingDetails.name')?.hasError('required') ? 'Name is required' : checkoutForm.get('billingDetails.name')?.hasError('minlength') ? 'Name must be at least 3 characters' : ''"
            />
          </div>
          <div class="input_container">
            <label for="email">Email Address</label>
            <app-auth-input
              id="email"
              type="email"
              placeholder="alexei@mail.com"
              [formControlName]="'email'"
              [hasError]="!!(checkoutForm.get('billingDetails.email')?.invalid && (checkoutForm.get('billingDetails.email')?.touched || checkoutForm.get('billingDetails.email')?.dirty))"
              [errorMessage]="checkoutForm.get('billingDetails.email')?.hasError('required') ? 'Email is required' : checkoutForm.get('billingDetails.email')?.hasError('email') ? 'Invalid email address' : ''"
            />
          </div>
          <div class="input_container">
            <label for="phone">Phone</label>
            <app-auth-input
              id="phone"
              type="tel"
              placeholder="+1202-555-0136"
              [formControlName]="'phone'"
              [hasError]="!!(checkoutForm.get('billingDetails.phone')?.invalid && (checkoutForm.get('billingDetails.phone')?.touched || checkoutForm.get('billingDetails.phone')?.dirty))"
              [errorMessage]="checkoutForm.get('billingDetails.phone')?.hasError('required') ? 'Phone is required' : ''"
            />
          </div>
        </div>
      </div>
      <div class="details shipping_info" formGroupName="shippingDetails">
        <p>Shipping Info</p>
        <div class="inputs_wrapper">
          <div class="input_container">
            <label for="address">Your Address</label>
            <app-auth-input
              id="address"
              type="text"
              placeholder="1137 Williams Avenue"
              [formControlName]="'address'"
              [hasError]="!!(checkoutForm.get('shippingDetails.address')?.invalid && (checkoutForm.get('shippingDetails.address')?.touched || checkoutForm.get('shippingDetails.address')?.dirty))"
              [errorMessage]="checkoutForm.get('shippingDetails.address')?.hasError('required') ? 'Address is required' : ''"
            />
          </div>
          <div class="input_container">
            <label for="zip">Zip Code</label>
            <app-auth-input
              id="zipCode"
              type="number"
              placeholder="10001"
              [formControlName]="'zipCode'"
              [hasError]="!!(checkoutForm.get('shippingDetails.zipCode')?.invalid && (checkoutForm.get('shippingDetails.zipCode')?.touched || checkoutForm.get('shippingDetails.zipCode')?.dirty))"
              [errorMessage]="checkoutForm.get('shippingDetails.zipCode')?.hasError('required') ? 'Zip code is required' : checkoutForm.get('shippingDetails.zipCode')?.hasError('minlength') ? 'Zip code must be at least 5 digits' : ''"
            />
          </div>
          <div class="input_container">
            <label for="city">City</label>
            <app-auth-input
              id="city"
              type="text"
              placeholder="New York"
              [formControlName]="'city'"
              [hasError]="!!(checkoutForm.get('shippingDetails.city')?.invalid && (checkoutForm.get('shippingDetails.city')?.touched || checkoutForm.get('shippingDetails.city')?.dirty))"
              [errorMessage]="checkoutForm.get('shippingDetails.city')?.hasError('required') ? 'City is required' : ''"
            />
          </div>
          <div class="input_container">
            <label for="country">Country</label>
            <app-auth-input
              id="country"
              type="text"
              placeholder="United States"
              [formControlName]="'country'"
              [hasError]="!!(checkoutForm.get('shippingDetails.country')?.invalid && (checkoutForm.get('shippingDetails.country')?.touched || checkoutForm.get('shippingDetails.country')?.dirty))"
              [errorMessage]="checkoutForm.get('shippingDetails.country')?.hasError('required') ? 'Country is required' : ''"
            />
          </div>
        </div>
      </div>
      <div class="details payment_details" formGroupName="paymentDetails">
        <p>Payment Details</p>
        <div class="inputs_wrapper">
          <label for="e_money">Payment Methods</label>
          <div class="input_container">
            <div class="options">
              <div class="radio_container">
                <label for="e_money">eMoney</label>
                <input
                  id="e_money"
                  type="radio"
                  value="e-money"
                  [formControlName]="'method'"
                />
              </div>
              <div class="radio_container">
                <label for="cash_on_delivery">Cash on Delivery</label>
                <input
                  id="cash_on_delivery"
                  type="radio"
                  value="cash-on-delivery"
                  [formControlName]="'method'"
                />
              </div>
            </div>
          </div>
        </div>
        @if (checkoutForm.get('paymentDetails.method')?.value !==
        'cash-on-delivery') {
        <div class="pin">
          <div class="e-payment">
            <label for="eMoneyNumber">e-Money Number</label>
            <app-auth-input
              id="eMoneyNumber"
              type="tel"
              placeholder="238521993"
              [formControlName]="'eMoneyNumber'"
              [hasError]="!!(checkoutForm.get('paymentDetails.eMoneyNumber')?.invalid && (checkoutForm.get('paymentDetails.eMoneyNumber')?.touched || checkoutForm.get('paymentDetails.eMoneyNumber')?.dirty))"
              [errorMessage]="checkoutForm.get('paymentDetails.eMoneyNumber')?.hasError('required') ? 'e-Money Number is required' : checkoutForm.get('paymentDetails.eMoneyNumber')?.hasError('minlength') ? 'e-Money Number must be at least 9 digits' : ''"
            />
          </div>
          <div class="e-payment">
            <label for="eMoneyPin">e-Money Pin</label>
            <app-auth-input
              id="eMoneyPin"
              type="number"
              placeholder="6891"
              [formControlName]="'eMoneyPin'"
              [hasError]="!!(checkoutForm.get('paymentDetails.eMoneyPin')?.invalid && (checkoutForm.get('paymentDetails.eMoneyPin')?.touched || checkoutForm.get('paymentDetails.eMoneyPin')?.dirty))"
              [errorMessage]="checkoutForm.get('paymentDetails.eMoneyPin')?.hasError('required') ? 'e-Money Pin is required' : checkoutForm.get('paymentDetails.eMoneyPin')?.hasError('minlength') ? 'e-Money Pin must be at least 4 digits' : ''"
            />
          </div>
        </div>
        } @else {
        <div class="cod">
          <img src="assets/cod.png" alt="cash-on-delivery-icon" />
          <p>
            The ‘Cash on Delivery’ option enables you to pay in cash when our
            delivery courier arrives at your residence. Just make sure your
            address is correct so that your order will not be cancelled.
          </p>
        </div>
        }
      </div>
    </div>
    <div class="summary_div card">
      <h3>Summary</h3>
      <div class="details summary_details">
        <div class="cart-items-list">
          @for (item of cartItems(); track item.id) {
          <div class="cart-item">
            <img
              [src]="item.product?.images?.[0]?.desktop_url || ''"
              alt="{{ item.product?.name }}"
              class="cart-item-img"
            />
            <div class="cart-item-info">
              <div class="details">
                <span class="cart-item-name">{{ item.product?.name }}</span>
                <span class="cart-item-price"
                  >{{ item.product?.price | currency }}</span
                >
              </div>
              <span class="cart-item-qty">x{{ item.quantity }}</span>
            </div>
          </div>
          }
        </div>
        <div class="summary-totals">
          <div class="summary-row">
            <span class="label">Total</span>
            <span class="value">{{ cartTotal() |currency}}</span>
          </div>
          <div class="summary-row">
            <span class="label">Shipping</span>
            <span class="value">{{ shipping() | currency}}</span>
          </div>
          <div class="summary-row">
            <span class="label">VAT (Included)</span>
            <span class="value">{{ vat() | currency}}</span>
          </div>
          <div class="summary-row grand">
            <span class="label">Grand Total</span>
            <span class="value">{{ grandTotal() | currency}}</span>
          </div>
        </div>
      </div>
      <button type="submit" class="pay-btn" [disabled]="!checkoutForm.valid">
        Continue & Pay
      </button>
    </div>
  </div>
</form>
<app-footer />

@if (showConfirmModal()) {
<app-confirm-checkout (close)="closeConfirmModal()" />
}
